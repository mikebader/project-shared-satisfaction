# Supplement

## Data Construction
### Correlation of education and income:

```{r education-income-correlation, echo=TRUE, include=TRUE}
ggplot(dcas, aes(x=dem.income.cat4,y=dem.educ.attain)) + geom_jitter()
```

## Within Neighborhood Robustness Analysis

The data from the DCAS 2016 raise the issue that I, by construction, only received responses from residents selected on two types of behaviors: residents who chose not to move out of multiracial neighborhoods and residents who selected to move into multiracial neighborhoods. Residents may have exhibited one or both of these behaviors. These residents might exhibit different levels of satisfaction that either those who left or chose not to move into multiracial neighborhoods. Given the importance of selection effects, and the importance of selection of whites in particular based on the predictions of existing theories, I examined analyses to mitigate concerns about selection effects among whites. 

Because of its cross-sectional design, the DCAS 2016 does not allow me to specifically test the hypothesis that dissatisfied residents disproportionately moved out of neighborhoods. I do, however, conduct a series of analyses to investigate whether sentiments among those who have stayed provide evidence that selection likely occurs. The first analyses examine levels of satisfaction among whites by duration of residence and the second examine interracial differences by the size of white population change in neighborhoods. 

Additionally, the between-neighbohrood analyses address the selection of whites *into* neighborhoods to some degree. By comparing the pool of white residents in the DC area, I observed differences between the satisfaction of that pool overall and the satisfaction of whites living in multiracial neighborhoods. If white residents who valued diversity above other amenities sought multiracial neighborhoods, then satisfaction would be as high among whites in multiracial neighborhoods as among whites in other neighborhoods, something that I did not find.[^recent-movers]

[^recent-movers]: Equal satisfaction would perhaps be more likely among white residents who recently moved than among those who have stayed in neighborhoods as they become integrated. I take up this possibility in the next section.

### Influence of length of residence on satisfaction

The first robustness analysis considers length of residence in neighborhoods by race. Evidence of white dissatisfaction with multiracial neighborhoods would be apparent if new white entrants failed to materialize in multiracial neighborhoods. Multiracial neighborhood integration would be the exclusive result, therefore, of white incumbents who stayed in multiracial neighborhoods. 
Figure \@ref(fig:supp-nhdyrs-race) shows evidence against this dynamic. Figure \@ref(fig:supp-nhdyrs-race) plots the distribution of years lived in their current neighborhood by the race of the respondent. While it is true that whites exclusively account for residents who have lived in neighborhoods longer than 40 years, the inverse is not true. Most residents, *even about half of white respondents* moved into multiracial neighborhoods in the past 10 years. The mixture of long-term and short-term white residents does not suggest that neighborhoods have become anathema to whites as they have become more integrated (though Table \@ref(tab:supp-nhdyrs-race-tbl) shows that whites do not move in as frequently as other racial groups). 

```{r supp-nhdyrs-race, fig.cap="Distribution of years lived in current neighborhood by race", echo=FALSE}
names(racelabs) <- racelevs[-1]
nhdyrs_race_plt <- ggplot(filter(dcas16, !is.na(nhdyrs), !is.na(raceeth)),
                          aes(x=nhdyrs)) +
    geom_bar() +
    scale_x_continuous(breaks = seq(0, 60, 5)) +
    facet_wrap(~raceeth, ncol=1, labeller = labeller(raceeth = racelabs)) +
    labs(
        title = "Distribution of years lived in current neighborhood by race",
        x = "Years lived in neighborhood"
    ) +
    theme_minimal()
nhdyrs_race_plt
```

```{r supp-nhdyrs-race-tbl, echo=FALSE}
dcas16svy <- dcas16svy %>%
    update(nhdyrscat = cut(nhdyrs, 
                           breaks=c(0,10,20,30,40,60), include.lowest = TRUE))
tbl <- with(dcas16svy,
            svyby(~nhdyrscat, ~raceeth, svymean))%>%
    MIcombine() %>% 
    coef() %>%
    matrix(nrow=4, byrow=FALSE)
rownames(tbl) <- racelabs[c(4, 1:3)]
colnames(tbl) <- levels(dcas16svy$designs[[1]]$variables$nhdyrscat)

kable(tbl, 
      digits=2,
      caption="Years lived in current neighborhood by race"
      ) %>%
    kable_styling(full_width = FALSE)
```

Previous theories and evidence suggest that the white residents who have stayed in multiracial neighborhoods will be some mixture of: 

#. white residents who have been satisfied living in integrated neighborhoods and chose not to leave (satisfied stayers), and 
#. white residents who have been stuck in the neighborhood without the means to move out of the neighborhood despite being dissatisified (dissatisfied stayers). 

The latter subgroup, the "dissatisfied stayers" would perceive neighbohroods similarly to those who were dissatisfied *and* able to leave. Meanwhile, previous theories and evidence do not provide a strong reason that the former subgroup, the "satisfied stayers," would have higher levels of satisfaction than new white entrants who selected multiracial neighborhoods above other neighborhood types. Without a reason to suspect that stayers would, on average, be more satisfied than the average new entrant, and stayers comprise both those satisfied and those dissatisfied with integration, then evidence of lower satisfaction among longer-term residents would provide some evidence in favor of selection. 

Figure \@ref(fig:supp-satisfied-years-whites) shows the (unweighted) smoothed percent of white residents satisified by length of residence in their neighborhoods. Given the importance of white residents to the theories, and the fact that the neighborhoods in the sample were almost all predominantly white neighborhoods that integrated over time, I focus on white respondents. Just under 70 percent of whites who lived in the neighborhood fewer than 40 years reported being satisfied, with a possible modest increase among those who lived in the neighborhood from 20 to 40 years. A consistent downward trend existed among the five percent of white residents who lived in the neighborhood for at least 40 years (but even then, more of those residents were satisfied than dissatisfied). 

```{r supp-satisfied-years-whites, fig.cap="Satisfaction by length of residence among whites in multiracial neighborhoods", message=FALSE, echo=FALSE}
nhwsat_nhdyrs_fig <- ggplot(filter(dcas16, raceeth=='white' & !is.na(nhdyrs)), 
       aes(x=nhdyrs, y=satisfied)) +
    geom_smooth(color='#333333') +
    scale_x_continuous(breaks=seq(0,60,10)) +
    scale_y_continuous(breaks=seq(0.2,1.0,0.1)) +
    labs(
        title = paste(
            "Satisfaction by length of residence among whites in", 
            "multiracial neighborhoods"
            ),
        subtitle = paste(
            "Unweighted percent of white residents living in multiracial",
            "neighborhoods"
            ),
        y = "Percent satisfied",
        x = "Years in neighborhood"
    ) +
    theme_minimal() 
nhwsat_nhdyrs_fig 

```

Recent white newcomers are not more satisfied than current white residents, a pattern that we would have expected if diversity-seeking whites entered multiracial neighborhoods filled with existing dissatisfied whites. Similarly, we do not see satisfaction decline among white residents who lived in the neighborhood longer, at least among those who lived in neighborhoods less than 40 years. 

The descriptive plot above does not, however, account for other factors that might correlate with satisfaction and length of residents, especially age, which mechanically correlates with length of residence. I created models that include a categorical variable for how long respondents have lived in multiracial neighborhoods and estimated parameters based only among white respondents. 

```{r supp-nhwsat-nhdyrs, warning=FALSE}
## Warnings are suppressed
## Subset data to include only white respondents
dcas16nhw <- subset(dcas16svy, raceeth=='white')

## Estimate model with fixed effects
m3yrs <- sub('nhdyrsc', 'nhdyrscat', m3) 
m3yrs <- sub('raceeth \\+', '', m3yrs)
m3nhwyrs <- with(dcas16nhw, svyglm(
    as.formula(paste('satisfied ~', m3yrs)), family=binomial)
)

m3yrs_wo <- sub('nhdyrscat \\+', '', m3yrs)
m3nhwyrs_wo <- with(dcas16nhw, svyglm(
    as.formula(paste('satisfied ~', m3yrs_wo)), family=binomial)
)

## Estimate model without fixed effects
m3yrs_nofe <- sub('sample_tract +', '', m3yrs)
m3nhwyrs_nofe <- with(dcas16nhw, svyglm(
    as.formula(paste('satisfied ~', m3yrs_nofe)), family=binomial)
)

m3yrs_nofe_wo <- sub('nhdyrscat \\+', '', m3yrs_nofe)
m3nhwyrs_nofe_wo <- with(dcas16nhw, svyglm(
    as.formula(paste('satisfied ~', m3yrs_nofe_wo)), family=binomial)
)


```

The results of these models are reported below. The first two columns report estimates of models with neighborhood fixed effects, meaning the models statistically compare white residents living in the same neighborhood. The first column shows that length of residence *does not* predict satisfaction among whites. The coefficients for residents who lived longer in their neighborhoods were negative, but the standard errors were double the estimated point estimates for two of three cases and as large as the point estimate for the third. What is more, the data fit the model without length of residence better than the model that included length of residence, evidence of which can be seen in the smaller AIC in the second column compared to the first. Table \@ref(tab:supp-nhwsat-nhdyrs-tbl)

```{r supp-nhwsat-nhdyrs-tbl, echo=FALSE}
yearlabs <- paste(
    c("11-20", "21-30", "31-40", ">40"), 
    "years in neighborhood"
)
nhwyrs_labels <- c(regression_labels[4:13], yearlabs,
                   regression_labels[15:16])
nhwyrs_tbl <- report_models(
    MIcombine_aic(m3nhwyrs), MIcombine_aic(m3nhwyrs_wo), 
    MIcombine_aic(m3nhwyrs_nofe), MIcombine_aic(m3nhwyrs_nofe_wo),
    reglabels = nhwyrs_labels,
    caption = paste(
        "Logistic regression coefficients and standard errors predicted",
        "of models estimating neighborhood satisfaction among white", 
        "residents of multiracial neighborhoods"
        )
)
section_headers <- c('Demographics', 'Education', 'Neighborhood perceptions')
nhwyrs_tbl <- nhwyrs_tbl %>%
    insert_row(c('Demographics', '', '', '', ''),
                after=(which(nhwyrs_tbl$names=='(Intercept)')+1)) %>%
    insert_row(c('Education', '', '', '', ''),
               after=(which(nhwyrs_tbl$names=='Married')+2)) %>%
    insert_row(c('Neighborhood perceptions', '', '', '', ''),
               after=(which(nhwyrs_tbl$names=='M.A.+')+3)) %>%
    insert_row(c('Neighborhood Fixed Effects', 'X', 'X', '', ''),
               after=(which(nhwyrs_tbl$names=='>50 blocks')+4))
nhwyrs_tbl <- set_italic(nhwyrs_tbl, 
                         which(nhwyrs_tbl$names %in% section_headers), everywhere, TRUE)

nhwyrs_tbl[1,] <- c('', '(1)', '(2)', '(1)', '(2)') 
nhwyrs_tbl

```

The third and fourth columns report analogous models without fixed effects. Removing the fixed effects (and not including any neighborhood covariates) allowed me to examine whether the duration of residence between any two white residents randomly drawn from any multiracial neighborhood in the DC Area differ from one another. Since we would expect neighborhood conditions to exert a strong influence on mobility decisions, then not accounting for neighborhood differences provides a conservative estimate regarding whether length of residence influences satisfaction among whites. Yet, again, none of the coefficients can be distinguished from a null association and the data fit the model without length of residence better than the model with length of residence. 

### Influence of white population change

The second analysis examined whether white residents were systematically less likely to be satisfied in neighborhoods that tended to lose more whites. The loss of whites could signal dissatisfaction as whites "vote with their feet" and move out of the neighborhood. In addition, the loss of white neighbors could lead white residents who remain to feel less satisfied with their neighborhoods.

To address the possibility that white losses affect satisfaction among whites, I stratified the data by the white population change that occurred in the neighborhood from 2000 to 2015 (the latter being based on the 2011-2015 Five-year American Community Survey estimates). To account for different neighborhood sizes, I calculated the ratio of whites living in the neighborhood in 2015 to the number of whites who lived in the neighborhood in 2000; I then took the natural log of this value (i.e., $\ln(\text{POP}_{2015}/\text{POP}_{2000})$) to obtain a linear variable to include in models. 

```{r supp-lntotchg-tertiles}
sampled_nhoods <- dcas16 %>%
    group_by(sample_tract) %>%
    slice(1L) %>%
    ungroup()

chgsum <- summary(sampled_nhoods$lntotchg)
chgtertiles <- quantile(sampled_nhoods$lntotchg, probs = seq(0, 1, 1/3))
gainnhw <- nrow(filter(sampled_nhoods, lntotchg>0)) / nrow(sampled_nhoods)

```

I collapsed the dataset into a neighborhood-level dataset and then calculated tertiles of change based on the distribution of neighborhood white population change. The average neighborhood in the dataset kept `r round(exp(chgsum['Mean']), 2)*100` out of every 100 of its white residents (median = `r round(exp(chgsum['Median']), 2)*100` out of 100). The bands for the white population ratio in each tertile reported in Table \@ref(tab:tertiles) and are depicted in orange in Figure \@ref(fig:supp-chgtert).


Table: Values of white population change ratio ranges by tertiles (#tab:tertiles) 

Tertile  Range of change ratio
-------- -------------------------------------------------------------------------
First    `r paste(sapply(chgtertiles[1:2], function(x) round(exp(x),2)), collapse ="-")`
Second   `r paste(sapply(chgtertiles[2:3], function(x) round(exp(x),2)), collapse ="-")` 
Third    `r paste(sapply(chgtertiles[3:4], function(x) round(exp(x),2)), collapse ="-")`


Table \@ref(tab:tertiles) and \@ref(fig:supp-chgtert) show considerable variation in how much white population change occurred in multiracial neighborhoods. The neighborhood with the largest negative change lost `r 100-round(exp(chgtertiles[1]),2)*100` percent of its white residents. At the top end of the first tertile, however, neighborhoods kept `r round(exp(chgtertiles[2]),2)*100` percent of white residents, a value near normal mobility rates over 15 years (approximately **TK** residents moved in the past year in 2010, for example). At the top end of the distribution, `r round(gainnhw, 2)*100` percent of neighborhoods *gained* white residents over 15 years. 

```{r supp-chgtert, echo=FALSE, fig.cap="Distribution of neighborhood white population change"}
qplot(sampled_nhoods$lntotchg, bins=40) +
    geom_vline(aes(xintercept = chgtertiles[2:3]), color='orange') +
    scale_x_continuous(breaks=seq(-2,2,.5), limits=c(-1.75,1.75)) +
    labs(
        title='Distribution of logged population change ratio of whites',
        y = 'N',
        x = 'Logged white population change ratio'
    ) +
    theme_minimal()
```

The data used in the main analyses, therefore, reflect neighborhoods with a large distribution of white population losses and gains. To examine whether interracial differences in satisfaction were consistent across this distribution of white neighborhood change, I stratified the DCAS 2016 by tertiles and re-estimated models (2) and (3) from Table 6 of the manuscript. 

```{r supp-lntotchg-analysis, warning=FALSE}
## Warnings are suppressed
## Create variable measuring tertiles of white population change in 
## DCAS 2016 data
dcas16svy <- dcas16svy %>%
    update(
        chgtert = factor(
                cut(lntotchg, breaks = chgtertiles, include.lowest = TRUE),
                labels = as.character(1:3)
            )
        )

## Subset DCAS 2016 data by tertile
svytert <- lapply(as.character(1:3), function(t){
    subset(dcas16svy, chgtert==t) %>%
        update(sample_tract = factor(as.character(sample_tract)))
})

## Estimate parameters of full model
m3tert <- lapply(svytert, function(svy){
    with(svy, svyglm(
        as.formula(paste('satisfied ~', m3)), family=binomial)
    )
})

## Estimate parameters of model without race
m4tert <- lapply(svytert, function(svy){
    with(svy, svyglm(
        as.formula(paste('satisfied ~', m4)), family=binomial)
    )
})

```

The parameter estimates, standard errors, and AIC values for the models are reported below. Model (2) in each of the tertiles includes race as a predictor of satisfaction. No effect exists that can be statistically distinguished from the null in any of the three models. In the two lowest tertiles, the data fit Model 3, which does not include race, than they fit Model 2. The data for the highest tertile fit the model that includes race better than the model that does not, but none of the race coefficients approach statistical significance. 

```{r supp-lntotchg-analysis-tbl, echo=FALSE}
## Function to gather and tidy imputed results and report summary statistics
combine_tertiles <- function(res){
    lapply(res, function(res){
        cmb <- MIcombine_aic(res)
        nobs <- nrow(res[[1]]$data)
        cmb$nobs <- nobs
        return(cmb)
    })
}

## Report models
m3comb <- combine_tertiles(m3tert)
m4comb <- combine_tertiles(m4tert)
chgtert_tbl <- report_models(
    m3comb[[1]], m4comb[[1]], m3comb[[2]], m4comb[[2]], m3comb[[3]], m4comb[[3]],
    caption = paste(
        "Logistic regression coefficients and standard errors predicted",
        "from models estimating neighborhood satisfaction among residents", 
        "of mulitracial neighborhoods by tertile of white population change"
        ),
    label = "tab:within",
    reglabels = regression_labels,
    use.headers = TRUE
)
statrow <- nrow(chgtert_tbl)-3
chgtert_tbl <- chgtert_tbl %>%
    insert_row(c("Tract fixed effects", rep("X", 6)),after=statrow) %>%
    set_top_border(statrow+1, everywhere, TRUE) %>%
    set_top_border(statrow+2, everywhere, FALSE) %>% 
    insert_row(c("", "First", "", "Second", "", "Third", ""), after=0) %>%
    merge_cells(1, c(2:3)) %>% 
    merge_cells(1, c(4:5)) %>%
    merge_cells(1, c(6:7)) %>%
    set_align(1, everywhere, 'center') %>%
    set_bottom_border(2, everywhere, TRUE) %>%
    set_top_padding(0) %>%
    set_bottom_padding(0)
chgtert_tbl[2,] <- c("", "(2)", "(3)", "(2)", "(3)", "(2)", "(3)")
gsub("```(.+\\n)?", "", to_latex(chgtert_tbl), perl=TRUE) %>% 
    cat(file="tables/within-by-change.tex")
chgtert_tbl

```

### Summary of within-neighborhood robustness analyses 

While the analyses above cannot definitively reject selection effects, they mitigate against the fear that the results showing shared satisfaction mask the strongest selection effects. Among whites, the group that previous research suggests would be the most likely to be affected by integration, the inclusion of the variable measuring length of residence did not improve the fit of the model. About half of white residents moved into multiracial neighborhoods in the past 10 years. They were not more satisfied than whites who moved into multiracial neighborhoods 20, 30, or 40 years prior. These data cannot defnitively disprove that whites who left in the intervening decades did so because their neighborhoods integrated. The results provide evidence, however, that satisfaction levels among the long-term white residents who happened into integrated neighborhoods by circumstance differ much from white residents who recently moved into the neighborhoods. It furthermore provides evidence of that a shared satisfaction among *current* residents will persist.  Evidence in favor of the shared satisfaction hypothesis was further bolstered by the fact that interracial differences in satisfaction were not systematically related to the share of the white population that left, minimizing a concern of spillover effects of white flight onto current white residents. 

## Between Neighborhood Robustness Analysis

### Satisfaction in DC area by neighborhood entropy

A different way to approach the between-neighborhood analysis reported in Figure 3 of the manuscript is to analyze the influence of racial composition on the sample that represents all DC-area residents using the DCAS 2018 data. The between neighborhood analysis showed:

#. satisfaction among white residents of multiracial neighborhoods is lower than satisfaction among white residents in general; and
#. satisfaction does not differ between residents of multiracial and other neighborhoods among Black, Latinx, and Asian residents in the DC area.

I use entropy to measure racial integration. Entropy reaches its maximum when each group makes up an equal share of residents in a neighborhood. Entropy offers a useful measure of multiracial diversity, however it does not account for differences between racial compositions at the same level of entropy (an all-white and all-Black neighborhood would, for example, both have entropy scores of zero). An alternative would be to categorize neighborhoods by presence of racial groups. Unfortunately sample sizes within different categories of racial composition do not allow me to meaningfully compare neighborhoods by composition. 

```{r supp-entropy-dcas2018, warning=FALSE}
## Warnings are suppressed
## Recenter entropy at mean level in DCAS 2016 neighborhoods
dcas16_mean_H <- mean(sampled_nhoods$H, na.rm=TRUE)
dcarea_sigma_H <- sd(dcarea$H, na.rm=TRUE)
dcas18svy <- dcas18svy %>%
    update(Hc = (H - dcas16_mean_H)/dcarea_sigma_H)

## Define models and estimate parameters
m5bn <- paste(m3bn, "+ Hc")
m5bn_ixn <- paste(m3bn, "+ Hc*raceeth")

m518 <- with(dcas18svy, svyglm(
    as.formula(paste('satisfied ~', m5bn)), family=binomial)
    )
m518_ixn <- with(dcas18svy, svyglm(
    as.formula(paste('satisfied ~', m5bn_ixn)), family=binomial)
    )
```

I centered entropy around the mean value of neighborhood entropy among DCAS 2016 respondents (H=`r round(dcas16_mean_H, 2)` out of a maximum of `r round(log(4), 2)`) and rescaled the variable so that values equal standard deviations based on all DC-area neighborhoods. Centering around the mean neighborhood included in the DCAS 2016 value allowed the intercept of the model to equal the average exposure used to predict values in Figure 3. I estimated two models, one that included entropy as an independent variable and a second that included interactions between entropy and respondent race. 

```{r supp-entropy-dcas2018-tbl, echo=FALSE}
raceixn_labs <- c("", "x Asian", "x Black", "x Latinx")
entropy_tbl <- report_models(
    MIcombine_aic(m518), MIcombine_aic(m518_ixn),
    reglabels = c(regression_labels,paste("Entropy", raceixn_labs)),
    caption = paste(
        "Logistic regression coefficients and standard errors predicted",
        "of models estimating neighborhood satisfaction among DC-area", 
        "residents including entropy index"
    ),
    label = "tbl:entropy"
)
entropy_tbl

```

```{r supp-entropy-dcas2018-lincom}
## Calculate average entropy exposure among whites in DC area
dcarea <- dcarea %>%
    mutate(nhwwgt = nhw15/sum(nhw15))
nhwH <- sum(dcarea$H * dcarea$nhwwgt, na.rm=TRUE)
nhwHc <- nhwH - dcas16_mean_H
nhwHsd <- nhwHc / dcarea_sigma_H

## Calculate total influence of entropy on satisfaction for non-white groups
m518_ixnc <- MIcombine_aic(m518_ixn)
entropy_satisfaction <- function(
    r,
    desmat = NULL,
    coefs = NULL
    ) {
    if(is.null(coefs)) coefs <- c('Hc', paste0('raceeth', r, ':Hc'))
    if(is.null(desmat)) desmat <- desmat <- rep(1, length(coefs))
    beta_r <- coef(m518_ixnc)[coefs]
    yhat_r <- t(desmat) %*% beta_r
    se_r   <- sqrt(t(desmat %*% vcov(m518_ixnc)[coefs, coefs] %*% desmat))
    p_r    <- pt(yhat_r / se_r, df = m518[[1]]$df.residual)
    ci_r   <- c(yhat_r - 1.96*se_r, yhat_r + 1.96*se_r) %>%
        sapply(plogis)
    return(list(yhat=yhat_r, se=se_r, pval = p_r, ci=ci_r))
}
nhw_quad <- entropy_satisfaction('white', coefs=c(1), desmat = c(1))
nhw_avg  <- entropy_satisfaction('white', coefs=c('(Intercept)', 'Hc'),
                                 desmat = c(1, nhwHsd))
entfx <- sapply(racelevs[2:4], entropy_satisfaction, desmat = c(-1, -1))


```

The values from the model including the interaction of race with entropy are consistent with the findings reported in Figure 3. Point estimates for whites calculated from Model (2) correspond closely to those reported in Figure 3. At the mean level of entropy in multiracial neighborhoods, Model (2) predicts that `r round(plogis(nhw_quad$yhat), 2)*100` percent of white residents would be satisfied (95% confidence interval: [`r round(nhw_quad$ci,2)*100`]), while `r round(plogis(nhw_avg$yhat), 2)*100` percent of white residents with the average white exposure in the DC area would be satisfied (95% confidence interval: [`r round(nhw_avg$ci, 2)*100`]). While the point estimates differed, the parameter estimate for the main effect of entropy in Model (2) could not be statistically distinguished from the null. 

Entropy had almost no influence on the satisfaction expressed by Blacks and Latinos. A one standard deviation decrease in entropy only reduced the odds of satisfaction among Black residents `r entfx[,'black'][['yhat']] %>% exp() %>% round(2)` (p$\approx$ `r entfx[,'black'][['pval']] %>% round(2)`) times and among Latinx residents `r entfx[,'latino'][['yhat']] %>% exp() %>% round(2)` (p$\approx$ `r entfx[,'latino'][['pval']] %>% round(2)`) times. Asian residents appeared to be more satisfied in less diverse neighborhoods; the odds of an Asian resident being satisfied were `r entfx[,'asian'][['yhat']] %>% exp() %>% round(2)` times higher for each standard deviation decrease in entropy and were marginally significant (p$\approx$ `r entfx[,'asian'][['pval']] %>% round(2)`).

<!-- Finally, Model (1) shows that white DC-area residents were more likely to be satisfied living in their neighborhoods than Asian, Black, and Latinx residents. The coefficients for Asian, Black, and Latinx respondents were negative in the model, though the difference from white residents was only statistically significant for Black residents despite relatively large coefficients for Asian and Latinx residents. Controlling for the interaction of race by entropy almost eliminated differences between whites and both Black and Latinx residents when entropy equaled the mean level found in multiracial neighborhoods. -->

In summary, this supplemental analysis shows:

#. that whites are less satisfied in multiracial neighborhoods with some possibility that the difference reflects a statistical artifact (roughly consistent with Figure 3), and
#. that satisfaction did not differ by level of neighborhood diversity among Black and Latino residents (consistent with Figure 3), but lowered satisfaction among Asian residents with some uncertainty whether the difference was a statistical artifact (inconsistent with Figure 3).



### Differences in white population change between multiracial and other neighborhoods

```{r supp-lntotchg-plt, fig.cap="Distribution of logged ratio of white population, 2015 to 2000", echo=FALSE}
stacked <- select(dcas16, lntotchg) %>% 
    mutate(year = 2016) %>%
    bind_rows(select(dcas18, lntotchg) %>% mutate(year = 2018))

lntotchg_plt <- ggplot(filter(stacked, !is.infinite(lntotchg)), 
                       aes(x=lntotchg)) +
    geom_histogram(binwidth=.125) +
    scale_x_continuous(breaks=-7:7) +
    facet_wrap(~year, ncol = 1) +
    labs(
        title="Distribution of logged ratio of white population, 2015 to 2000",
        x = "Logged ratio of white change",
        y = "Count"
    ) +
    theme_minimal()
lntotchg_plt
```

A second analysis assesses the influence of changing white population on satisfaction among residents of the DC area. Using the same measure that I did above (the logged ratio of the white populations in 2015 to those in 20000, I examined the distribution of changes respondents in the DCAS 2016 experienced compared to those that the DCAS 2018 experienced. Figure \@ref(fig:supp-lntotchg-plt) plots these two distributions and Table \@ref(tab:supp-white-change-tbl) reports descriptive statistics of the changes. 

```{r supp-white-change-tbl, echo=FALSE}
kable(bind_cols(tibble(Year=c(2016,2018)), bind_rows(
    summary(dcas16$lntotchg[!is.infinite(dcas16$lntotchg)]),
    summary(dcas18$lntotchg[!is.infinite(dcas18$lntotchg)])
)), digits = 2, caption="Descriptive statistics of logged white change, 2016 and 2018 DCAS respondents") %>%
    kable_styling(full_width = FALSE)
```

One can see from both Figure \@ref(fig:supp-lntotchg-plt) and Table \@ref(tab:supp-white-change-tbl) that respondents to the DCAS 2018 live in neighborhoods that experienced a much larger distribution of change than the respondents to the DCAS 2016. Ignoring the one outlying neighborhood where the logged change ratio equaled almost seven, the standard deviation of logged white change among DCAS 2018 respondents was `r sd(filter(stacked, year==2018, lntotchg<6, !is.infinite(lntotchg))$lntotchg, na.rm=TRUE) %>% round(2)` while the standard deviation among DCAS 2016 residents was `r sd(filter(stacked, year==2016, !is.infinite(lntotchg))$lntotchg, na.rm=TRUE) %>% round(2)`.[^king-farm]

[^king-farm]: The census tract with the dramatic change was where a new subdivision was built where previously a single family lived on a family-owned farm. 

```{r supp-lntotchg, warning=FALSE}
## Warnings are suppressed
## Create datasets that remove impossible values of lntotchg
dcas16svyln <- subset(dcas16svy, !is.infinite(lntotchg), lntotchg < 6)
dcas18svyln <- subset(dcas18svy, !is.infinite(lntotchg), lntotchg < 6)

mean18 <- with(dcas18svyln, svymean(~lntotchg)) %>% MIcombine() %>% coef()
var18  <- with(dcas18svyln, svyvar(~lntotchg)) %>% MIcombine() %>% coef()

dcas16svyln <- update(dcas16svyln, whiterat = (lntotchg - mean18)/sqrt(var18))
dcas18svyln <- update(dcas18svyln, whiterat = (lntotchg - mean18)/sqrt(var18))

## Estimate models of satisfaction with interactions by white change
m6bn <- paste(m3bn, "+ whiterat")
m7bn <- paste(m3bn, "+ whiterat*raceeth")

m616 <- with(dcas16svyln, svyglm(
    as.formula(paste('satisfied ~', m6bn)), family=binomial)
)
m716 <- with(dcas16svyln, svyglm(
    as.formula(paste('satisfied ~', m7bn)), family=binomial)
)

m618 <- with(dcas18svyln, svyglm(
    as.formula(paste('satisfied ~', m6bn)), family=binomial)
)
m718 <- with(dcas18svyln, svyglm(
    as.formula(paste('satisfied ~', m7bn)), family=binomial)
)
```


I examined whether the white population change from 2000 to 2015 affected the results reported in Figure 3. I added the logged change ratio to models for both respondents representing residents of multiracial neighborhoods (DCAS 2016 respondents) and those representing residents of the entire DC area (DCAS 2018 respondents). I centered the variable around the mean change experienced by DCAS 2018 respondents and scaled the variable by the standard deviation of the DCAS 2018 respondents.  I estimated two models for each set of data, one each with and without interactions with race. The interactions would account for the different sensitivity white residents have to the loss of white neighbors. The parameter estimates and standard errors are reported in Table \@ref(tab:lnchgtot).

The first two columns of Table \@ref(tab:lnchgtot) report parameter estimates using data representing residents of multiracial neighborhoods. The results in the first column show that residents were more satisfied in neighborhoods that gained more whites--or, inversely, lost fewer whites. The odds of being satisfied aong residents of multiracial neighborhoods where white change was one standard deviation above the DC-area mean were `r exp(coef(MIcombine_aic(m616))['whiterat']) %>% round(2)` times higher than residents of multiracial neighborhoods that matched the DC-area-wide mean. Consistent with the findings reported in Table \@ref(tab:chgtert) above showing no racial differences across tertiles of white population change, I found a worse fit of the data to the model with an interaction between white population change and race than the model without. The results imply that white growth (or the absence of white loss) increases satisfaction, but *it does so equally across all racial groups*.  

```{r supp-lntotchg-tbl, echo=FALSE}
cap = paste(
        "Logistic regression coefficients and standard errors predicted",
        "of models estimating neighborhood satisfaction among",
        "residents of multiracial neighborhoods and the DC-area, including",
        "logged change ratio of white population"
    )
bn2018_supp_tbl <- report_models(
    MIcombine_aic(m616), MIcombine_aic(m716), 
    MIcombine_aic(m618), MIcombine_aic(m718),
    reglabels = c(regression_labels,
                  paste("Logged white change", raceixn_labs))
    # ,
    # caption="caption",
    # label="tab:lnchgtot"
) %>%
    set_caption(paste('(#tab:lnchgtot)', cap))
bn2018_supp_tbl

```

The second two columns of Table \@ref(tab:lnchgtot) report parameter estimates using data representing all DC-area residents. The amount of what change that occurred in the neighborhood had little influence on satisfaction of residents, though in the case of residents from the entire DC-area the data fit the model with an interaction better. The fourth column shows that the influence of white population growth was higher for Asian and Latinx residents was higher than the influence on whites, though only the the association for Latinx residents could be distingushed from the null. 

### Summary of between-neighborhood robustness analysis

The analyses of entropy among only DCAS 2018 respondents showed that satisfaction among White residents correlates with the racial diversity of neighborhoods. Satisfaction among other racial groups appeared be insensitive or less senstive than whites to the racial diversity of neighborhood residents. These results comport with the findings reported in Figure 3 that compared the results of the two surveys. 

The influence of white population change were different in multiracial neighborhoods than DC-area neighborhoods generall. Residents of multiracial neighborhoods, regardless of race, were more likely to be satisfied in neighborhoods where white populations had increased. This finding supports the notion of shared satisfaction across racial groups living in multiracial neighborhoods. 

Among neighborhoods in the DC area generally, Asian and Latinx were more likely satisfied than white and Black residents. The satisfaction of White and Black residents seemed unassociated with white population change. The differences between groups among neighborhoods in general do not contradict any of the conclusions of this paper, but do shed light on an area for further research. 

## Neighborhood Change Robustness Analysis

### Multinomial Logistic Regression of Neighborhood Change Questions
```{r improvement-analysis-multinomial}
library(svrepmisc)
des <- as.svrepdesign(svy$designs[[1]], type="bootstrap" , replicates=250)
m3m_bet <- svymultinom(as.formula(paste('nhd.change3 ~', m3)),
                       design = des)
tbl <- tidy(m3m_bet)[1:8,] %>%
    mutate(star = if_else(p.value < .001, '***',
                          if_else(p.value < .01, '**',
                                  if_else(p.value < 0.05, '*', ''))))
vals <- function(i) {
    c(sprintf("%5.3f", tbl[i,2]), sprintf("(%5.3f)", tbl[i,3]))
}

df <- tibble(
    Variable = c("Intercept", "", "Asian", "", "Black", "", "Latinx", ""),
    Better = c(sapply(seq(1, 7, 2), vals)),
    ` `  = c(sapply(tbl[seq(1, 7, 2), 6], c, "")),
    Worse  = c(sapply(seq(2, 8, 2), vals)),
    `  `  = c(sapply(tbl[seq(2, 8, 2), 6], c, ""))
)

kable(df, align = 'lrlrl', format = 'pandoc')
```

