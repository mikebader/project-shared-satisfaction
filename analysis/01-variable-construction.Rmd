# Data
```{r subset-data}
rm(list=ls())
dataDIR <- '~/work/data/dcas/dcas2016/'
load(paste0(dataDIR,'Dataset/R/DCAS_2016_weighted.Rdata'))

dcas$quad <- dcas$neighborhood=='Global Neighborhood'
table(dcas[,c('neighborhood','quad')])
N_norace <- sum(is.na(dcas$dem.race) & dcas$quad==TRUE)
dcas <- dcas[!is.na(dcas$dem.race) & dcas$quad==TRUE,]
dcas$sample_tract <- droplevels(dcas$sample_tract)
# dcas$sample_tract <- relevel(dcas$sample_tract, ref="51059452600")
N_quad <- length(dcas$studycase)
N <- sum(!is.na(dcas$dem.race))
```

## Multiethnic Neighborhoods in the Washington, D.C. Area

Data to test the hypotheses come from the 2016 DC Area Survey (DCAS). Washington, D.C. has historically been a segregated metropolitan area. Almost all blacks lived in the eastern part of the city and nearly all whites in the west. This east-west pattern spilled out to the Maryland suburbs. Few blacks lived across the Potomac River in Northern Virginia, though they were highly clustered in a small number of neighborhoods. In 1970, only TK% and TK% of Asians and Latinxs lived in the DC area. 

The region's economy grew and became less based on the federal government in the 1980s and 1990. The expansion of finance, insurance, and real estate services, collectively known by the acronym FIRE, mirrored the sector's prominence in redeveloping metropolitan areas in the U.S. and abroad. During the same period, the region emerged as an immigrant destination. As the nation's capital and importance in international relations, the region's foreign-born residents are more socioeconomically diverse than average. Latinos and Asians now comprise TK% and TK%, respectively, of the DC area while blacks make up TK% and whites TK%. TK residents were born outside of the United States, with the largest shares coming from El Salvador, TK, and TK. 

Real estate developers capitalized on the expanding population by developing large swaths of land in middle-ring suburbs in the counties surrounding the District. Having been built after the Fair Housing Act passed, the residences developed in these suburbs were not subject to the history of redlining restrictive covenants of previous developments. Residents of all races were attracted to these new suburban homes, especially in Montgomery and Fairfax Counties that boasted nationally renowned school systems. As Figure TK shows, multiethnic neighborhoods were especially likely to emerge along the hub-and-spoke system of the region's commuter rail lines. Additionally, Montgomery County has, since 1974, mandated that all housing developments larger than 20 units include a set percentage of units that qualify as affordable housing.[^fairfax-iz]

[^fairfax-iz]: Fairfax County passed an inclusionary zoning ordinance in 1971, but it was struck down by the Virginia Supreme Court. Fairfax County implemented a different mandatory inclusionary zoning policy in 1990. 

The 2016 DCAS sought to represent residents of two types of neighborhoods--multiethnic and disproportionately Latinx--in the Washington, D.C. area, which comprised Washington, D.C. and the surrounding jurisdictions of Montgomery and Prince George's Counties in Maryland, Arlington and Fairfax (including the cities of Falls Church and Fairfax) Counties Virginia, and the independent city of Alexandria, Virginia. Only responses from residents sampled in the multiethnic neighborhoods were included in this analysis.[^latinx] 

[^latinx]: Disproportionately Latinx neighborhoods were those in which Latinx residents made up at least a quarter of the residents and were not already classified as a multiethnic neighborhood. 

Multiethnic neighborhoods included in the sampling frame met two criteria. First, Asians, blacks, Latinxs, and whites each comprised at least 10~percent of the population of the neighborhood. This cutoff was used to ensure that each of the four racial groups represented a distinguishable subset of a neighborhood's residents. Second, none of those four groups could represent a majority of residents. This criterion was included to eliminate neighborhoods where a single group formed the dominant identity of the neighborhood. These criteria resulted in a sample frame of TK neighborhoods, with the majority in Montgomery County, Maryland, followed by Fairfax County, Virginia, then TK... The neighborhoods included in the sampling frame are shown in Figure TK. An address-based sample of households was drawn from these eligible neighborhoods that included oversamples of households with Asian and Hispanic surnames and households located in from disproportionately black tracts (that still satisfied the criteria as multiethnic neighborhoods).

Fourteen neighborhoods met the first inclusion criterion but not the second. Of those fourteen, TK were neighborhoods that had a white majority and were located in TK (N),... Only TK had a black majority, and [both?] were located in the gentrifying neighborhood of TK. Only [TK] neighborhood had a Latinx majority. 

A 12-page survey booklet was mailed to 9,600 households in those two types of neighborhoods along with a one-page cover letter written in English and Spanish on opposite sides, a two-dollar bill as an incentive, and a postage-paid return envelope. A reminder was sent to all households that had not responded approximately two weeks after the original survey was sent. By the end of the 54-day field period, 1,222 households responded with complete surveys, 674 of which were from households in multiethnic neighborhoods. The responses from the entire sample represeted a 12.8 percent response rate (AAPOR RR4 standard). 

## Dependent Variables
### Satisfaction Variable
The current neighborhood satisfaction variable (`satisfied`) comes from Question 5: "How satisfied are you with your neighborhood as a place to live?" Responses of "Extremely satisfied" and "Very satisfied" are coded as "satisfied" (`1`); other responses ("Somewhat satisfied" and "Not at all satisfied" and coded as "unsatisfied" [`0`]). 

### Neighborhood Change Variable
The satisfaction with neighborhood change variable (`better`) comes from Question 9: "Looking back over the past five years or so, would you say that your neighborhood has:" Response options "Become a much better place to live" and "Become a somewhat better place to live" are coded as "better" (`1`) and the other three responses are coded as "not better" (`0`). 

```{r dependent-variables}
dcas$satisfied <- dcas$nhd.satisfaction %in% c(
                       'Extremely satisfied','Very satisfied')*1
table(dcas[, c('nhd.satisfaction','satisfied')])
dcas$extremely_satisfied <- as.numeric(dcas$nhd.satisfaction=='Extremely satisfied')*1
table(dcas[, c('nhd.satisfaction','extremely_satisfied')])

dcas$better <- dcas$nhd.change %in% c(
                       'Much better', 'Somewhat better')*1
table(dcas[, c('nhd.change','better')])
dcas$much_better <- (dcas$nhd.change=='Much better')*1
table(dcas[, c('nhd.change','much_better')])
```



<!-- ## Preferences for Other Communities -->
```{r rename-commvars}
## Change names to have search dimension first and commname second
## Help on regex part: https://stackoverflow.com/questions/952275/regex-group-capture-in-r-with-multiple-capture-groups
# search.vars <- grep('nhd\\.srch.+\\.', names(dcas), value=TRUE)
# new_search_matches <- regmatches(
#     search.vars, regexec('nhd\\.srch\\.(.+)\\.(.+)$', search.vars))
# new_search_names <- sapply(new_search_matches, function(x){
#     paste(rev(x[2:3]), collapse='_')})
# names(dcas)[names(dcas)%in%search.vars] <- new_search_names
# 
# dcas$consider_num <- rowSums(dcas[grep('^cons_', names(dcas))])
# dcas$consider_any <- dcas$consider_num > 0
# dcas$notconsider_num <- rowSums(dcas[grep('^nc_', names(dcas))])
# dcas$notconsider_any <- dcas$notconsider_num >0
```


## Independent Variable
The independent variable for these analyses is self-identified race that has been recoded to represent non-Latinx white alone, non-Latinx black alone or in combination with other races, Latinx of any race, and non-Latinx Asian or Pacific Islander alone or in combination with any race except black. Respondents with other races were dropped from the analysis (N=`r N_norace`). This left a final analytic dataset of `r N` respondents.

```{r independent-variables}
table(dcas$dem.race, useNA='always')
dcas$dem.race <- relevel(dcas$dem.race, ref='white')
```

These data are ideal to answer the hypotheses because:
    * They are representative of residents living in quadrivial neighborhoods
    * They ask about satisfaction and neighborhood improvement using same questions that have been used in previous studies
    * Have a sufficient sample of all four racial groups to compare results across racial groups


## Control Variables
In addition to racial variables, I also included variables to control for other demographic characteristics of residents. 

**Demographic characteristics**

* *Age*, calculated from answer to Question 49: "In what year were you born?"

* *Foreign born*, answer to Question 58: "Where were you born?"

* *Gender*, male or female

* *Kids*, if answer to Question 2--"How many children ages 17 or under live in your household?"--is greater than zero

* *Marital status*, if answer to Question 60--"What is your marital status"-- is "Now married or in a married-style arrangement"

```{r demographic-variables}

dcas$age <- dcas$dem.age - 50 ## Center at age 50
dcas$forborn <- dcas$dem.forborn
dcas$man <- dcas$dem.gender.mf=='Male'
dcas$kids <- as.numeric(as.character(dcas$q2)) > 0
dcas$kids[as.numeric(as.character(dcas$q2)) > 90] <- NA
dcas$married <- grepl("Now married", dcas$dem.marital.stat)
table(dcas[,c('dem.marital.stat','married')]) ##Check recoding
```
**Economic Status**

* *Educational attainment*, five categories based on Question 59, "What is the highest level of school you have completed or the highest degree you have received?" Used only educational attainment because it was highly correlated with income and would likely pick up stable features of status differences.

<!-- * *Income*, four categories based on Question 64, "Last year, that is in 2015, what was your total family income from all sources before taxes?" -->

```{r economic-variables}
dcas$educ <- factor(dcas$dem.educ.attain, order=FALSE) %>% 
                relevel(ref='H.S.')
educ_dummies <- paste0('educ',1:5)
dcas[,educ_dummies] <- lapply(1:5,
        function(i) {unclass(dcas$dem.educ.attain)==i})
for(i in 1:5) { ##Check recoding
    print(table(dcas[,c('dem.educ.attain',paste0('educ',i))]))
}
# educ_names <- levels(dcas$dem.educ.attain)
# educ_names[1] <- paste0("\\emph{Educational Attainment}&&\\\\", educ_names[1])

dcas$inc <- dcas$dem.income.cat4
inc_dummies <- paste0('inc',1:4)
dcas[,inc_dummies] <- lapply(1:4,
        function(i) {unclass(dcas$dem.income.cat4)==i})
for(i in 1:4) { ## Check recoding
    print(table(dcas[,c('dem.income.cat4',paste0('inc',i))]))
}
# inc_names <- sanitize(levels(dcas$dem.income.cat4))
# inc_names[1] <- paste0("\\emph{Income}&&\\\\", inc_names[1])
```

**Neighborhood Experience**
In addition to demographic characteristics, I also included controls for the respondent's experience in the neighborhood. 

* *Years in neighborhood*, based on Question 4: "How many years have you lived in your current neighborhood?" (The length of time that respondents have lived in their neighborhoods could affect their perception of neighborhood quality and certainly neighborhood change)

* *Neighborhood size*, based on Question 7: "How many blocks are in the area that you think of as your neighborhood?" (The size of the area the respondent conjures as being part of their neighborhood could affect perceptions of neighborhood quality and change)

```{r nhood-variables}
dcas$nhdyrs <- as.numeric(as.character(dcas$q4)) - 10 ## Center at 10 years
dcas$nhdyrsc <- scale(dcas$nhdyrs, scale=FALSE)
qplot(dcas$nhdyrsc)

dcas$nhdsize[unclass(dcas$nhd.size)%in%c(1,2)] <- '1-9 blocks'
dcas$nhdsize[unclass(dcas$nhd.size)%in%c(3,4)] <- '10-50 blocks'
dcas$nhdsize[unclass(dcas$nhd.size)==5] <- '>50 blocks'
dcas$nhdsize <- factor(dcas$nhdsize, 
                        levels=c('1-9 blocks', '10-50 blocks', '>50 blocks'))
dcas$nhdsize <- relevel(dcas$nhdsize, ref='1-9 blocks')
table(dcas[,c('nhd.size', 'nhdsize')], useNA='always') ## Check recoding
```

**Residence variables**

* *State of residence*, factor variable indicating the state in which the respondent lives.  
```{r residence-variables}
dcas$state <- sapply(dcas$sample_tract, substr, start=1, stop=2)
dcas$state[dcas$state=='24'] <- 'Maryland'
dcas$state[dcas$state=='51'] <- 'Virginia'
dcas$state <- factor(dcas$state)
```
<!--
**Centered Variables**

Create grand-mean centered variables.
-->
```{r centering}
center <- function(x) { ## Function to mean-center but not scale vars
    scale(as.numeric(dcas[[x]]), scale=FALSE)
}
dcas$agec <- scale(dcas$dem.age, scale=FALSE)
dcas$forbornc <- center('dem.forborn')
dcas$manc <- center('man')
dcas$kidsc <- center('kids')
dcas$marriedc <- center('married')
dcas[,c(paste0(educ_dummies,'c'))] <- scale(dcas[,paste0('educ',1:5)], 
                                          scale=FALSE)
dcas[,c(paste0(inc_dummies, 'c'))] <- scale(dcas[,paste0('inc',1:4)],
                                         scale=FALSE)
```
