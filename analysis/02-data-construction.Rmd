# Data Construction

**Multiple Imputation & Survey Weights**
Several variables have a substantial amount of missing data. I used the Amelia package to create five imputation datasets that will be combined for the final results. I then set up the survey dseign using the list of imputed datasets to account for the complex survey design.

```{r weights}
## Use uncentered values because they need to be re-centered for Quadrivial Nhood respondents
vars <- c(
          'satisfied', 'better'
          , 'extremely_satisfied', 'much_better'
          , 'dem.race'
          , 'age'
          , 'forborn'
          , 'man'
          , 'kids'
          , 'married'
          # , 'educ1', 'educ2', 'educ3', 'educ5'
          , 'educ'
          # # , 'inc1', 'inc3', 'inc4'
          , 'nhdyrs'
          # , 'nhdsize1', 'nhdsize3'
          , 'nhdsize'
          # , 'consider_num', 'consider_any', 'notconsider_num', 'notconsider_any'
          # , unlist(grep('(?<!live_columbia.heights)$',new_search_names,
          # value=TRUE, perl=TRUE))
          # , unlist(grep('^cons_', new_search_names, value=TRUE, perl=TRUE))
          # , unlist(
          #     grep('(?<!huntington)$', new_search_names, value=TRUE, perl=TRUE)
          # ))
)
dcas$studycase <- as.character(dcas$studycase)
idvars <- c('studycase','weight', 'sample_strata')
dcassub <- dcas[, c(vars, idvars)]
nominals <- vars[!(vars %in% c('age', 'nhdyrs', 
                               'consider_num', 'notconsider_num'))]
set.seed(214518)
dcasmi <- amelia(dcassub, m=5, noms=nominals, emburn = c (500 , 500) , 
                 p2s = F, idvars=idvars)
dcasmi$imputations <- lapply(dcasmi$imputations, merge,
                             dcas[,c('studycase',unlist(new_search_names))], 
                             by='studycase')
dcassvy <- svydesign(id=~1,strata=~sample_strata,weights=~weight,data=imputationList(dcasmi$imputations))
save(vars, dcassvy, dcas, dataDIR, file = '../data/dcassvy.Rdata')
```
